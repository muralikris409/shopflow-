"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[575],{6046:(e,r,o)=>{var t=o(6658);o.o(t,"useRouter")&&o.d(r,{useRouter:function(){return t.useRouter}}),o.o(t,"useSearchParams")&&o.d(r,{useSearchParams:function(){return t.useSearchParams}})},3575:(e,r,o)=>{o.r(r),o.d(r,{default:()=>i});var t=o(5155),s=o(2115),a=o(2738),l=o(3391);o(2895);var d=o(6046),n=o(2089);let c=e=>{let{product:r,onCancel:o,cancelLoading:s}=e,a=(0,d.useRouter)();return(0,l.wA)(),(0,t.jsxs)("div",{className:"product-card p-5 bg-white rounded-lg shadow-lg mb-4 w-full sm:w-96 lg:w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold text-gray-800",children:["Order ID: ",(0,t.jsxs)("span",{className:"text-gray-500",children:["#",r.orderId]})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Placed on: ",new Date(r.orderDate).toLocaleDateString()]})]}),(0,t.jsx)("p",{className:"font-semibold ".concat("CONFIRMED"===r.status?"text-green-600":"CANCELLED"===r.status?"text-red-600":"text-gray-600"),children:r.status})]}),(0,t.jsxs)("div",{onClick:()=>{a.push("/product/".concat(r.productId))},className:"flex flex-col sm:flex-row items-start space-y-4 sm:space-x-4 mb-4",children:[(0,t.jsx)("img",{src:r.image||"/_assets/image.png",alt:r.productName,className:"w-16 h-16 object-cover rounded-md border"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:r.productName}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["$ ",r.offerPrice.toLocaleString()," x ",r.quantity]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[(0,t.jsxs)("p",{className:"font-semibold text-lg",children:["Total: $ ",(r.offerPrice*r.quantity).toLocaleString()]}),"CANCELLED"!==r.status&&(0,t.jsx)("button",{className:"mt-3 sm:mt-0 px-4 py-2 text-white text-sm rounded ".concat(s===r.orderId?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"),onClick:()=>{o(r.orderId)},disabled:s===r.orderId,children:s===r.orderId?"Cancelling...":"Cancel Order"})]})]})},i=()=>{let[e,r]=(0,s.useState)([]),[o,l]=(0,s.useState)([]),[d,i]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),[v,x]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{try{i(!0);let e=await (0,a.gY)(),o=null==e?void 0:e.data;console.log(o);let t=null==o?void 0:o.flatMap(e=>e.items.map(r=>({...r,orderDate:e.orderDate,totalAmount:e.total})));r(t||[]),l(t||[])}catch(e){m((null==e?void 0:e.message)||"An error occurred")}finally{i(!1)}})()},[]);let f=async o=>{try{h(o),await (0,a.N4)(o);let t=e.map(e=>e.orderId===o?{...e,status:"CANCELLED"}:e);r(t),l(t.filter(e=>e.productName.toLowerCase().includes(v)))}catch(e){m((null==e?void 0:e.message)||"Failed to cancel order")}finally{h(null)}};return d?(0,t.jsx)(n.a,{}):u?(0,t.jsxs)("div",{className:"text-red-500 text-center text-lg",children:["Error: ",u]}):(0,t.jsxs)("div",{className:"w-full  h-screen mx-auto p-2 md:p-4 bg-white rounded-lg shadow-md overflow-y-scroll overflow-x-hidden ",children:[(0,t.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row justify-between",children:[(0,t.jsx)("h2",{className:"text-3xl font-semibold text-gray-800 mb-6",children:"My Orders"}),(0,t.jsx)("input",{type:"text",placeholder:"Search for products in your orders",value:v,onChange:r=>{let o=r.target.value.toLowerCase();x(o),l(e.filter(e=>e.productName.toLowerCase().includes(o)))},className:"w-70 sm:w-80 h-1/5 p-3 rounded-md border border-gray-300"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:0===o.length?(0,t.jsx)("div",{className:"col-span-full text-center text-xl font-semibold text-gray-500",children:"No orders found."}):o.map((e,r)=>(0,t.jsx)(c,{product:e,onCancel:f,cancelLoading:g},"".concat(e.orderId,"-").concat(r)))})]})}},2089:(e,r,o)=>{o.d(r,{a:()=>s});var t=o(5155);o(2115);let s=()=>(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-200",children:(0,t.jsxs)("div",{className:"relative  flex items-center justify-center bg-white rounded-full shadow-2xl",children:[(0,t.jsx)("div",{className:"absolute w-full h-full border-4 border-t-transparent border-blue-500 rounded-full animate-spin"}),(0,t.jsx)("img",{src:"/_assets/loader.gif",alt:"Loading...",className:"w-24 h-24 drop-shadow-lg"})]})})},2895:(e,r,o)=>{o.d(r,{Ay:()=>l,Dh:()=>a,Sd:()=>s});let t=(0,o(8943).Z0)({name:"props",initialState:{product:null,history:null},reducers:{setProductData(e,r){console.log(r),e.product=r.payload,console.log(r.payload)},setHistory(e,r){e.history=r.payload,console.log(e.history)}}}),{setProductData:s,setHistory:a}=t.actions,l=t.reducer},2738:(e,r,o)=>{o.d(r,{N4:()=>c,TU:()=>d,fS:()=>s,gY:()=>n,kp:()=>a,p:()=>i,yT:()=>l});var t=o(6301);let s=async e=>{try{let r=await t.S.post("/user/order/createOrder",{items:e});return console.log(r),r.data}catch(e){var r,o;throw console.error("Error creating order:",e),Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error creating order.")}},a=async e=>{try{return(await t.S.get("/user/order/getOrderForCheckout/?orderId=".concat(e))).data}catch(e){var r,o;return console.error("Error fetching order for checkout:",e),{status:"error",message:(null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"An error occurred while fetching the order."}}},l=async(e,r,o,s)=>{console.log("order_id:",e),console.log("razorpayId:",r),console.log("paymentId:",o),console.log("siign:",s);try{return(await t.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:r,paymentId:o,paymentSignature:s}})).data}catch(e){var a,l;throw console.error("Error verifying payment:",e),Error((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.message)||"Error verifying payment.")}},d=async e=>{console.log("orderid:",e);try{return(await t.S.post("/user/order/checkoutOrder?orderId=".concat(e))).data}catch(e){var r,o;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},n=async()=>{try{return(await t.S.get("/user/order/getUserOrder")).data}catch(o){var e,r;throw console.error("Error fetching user orders:",o),Error((null==o?void 0:null===(r=o.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||"Error fetching user orders.")}},c=async e=>{console.log(e);try{return(await t.S.put("/user/order/cancelOrder?orderId=".concat(e))).data}catch(e){var r,o;throw console.error("Error cancelling order:",e),Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error cancelling order.")}},i=async e=>{console.log("userId:",e);try{let r=await t.S.get("/user/order/getOrderById?orderId=".concat(e));return console.log(r.data),r.data}catch(e){var r,o;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}}},6301:(e,r,o)=>{o.d(r,{S:()=>a});var t=o(2651),s=o(9208);let a=t.A.create({baseURL:"https://shopflow-1-ugli.onrender.com"});a.interceptors.request.use(e=>{var r;let o=s.A.get("shopflow_session");if(!o)return e;let t=null===(r=JSON.parse(o))||void 0===r?void 0:r.token;return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e))}}]);
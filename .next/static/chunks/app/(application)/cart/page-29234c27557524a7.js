(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{3967:(e,r,t)=>{Promise.resolve().then(t.bind(t,2205))},6046:(e,r,t)=>{"use strict";var a=t(6658);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},4234:(e,r,t)=>{"use strict";t.d(r,{Bj:()=>n,CG:()=>c,Xl:()=>u,o7:()=>d,qY:()=>i});let a="shopflow";function o(){let e=localStorage.getItem(a);return e?JSON.parse(e):[]}function s(e){localStorage.setItem(a,JSON.stringify(e))}function l(e,r){return e.findIndex(e=>e.id===r)}function n(e){let r=o(),t=l(r,e.id);-1===t?r.push({...e,quantity:1}):r[t].quantity+=1,s(r)}function i(e){let r=o();s(r=r.filter(r=>r.id!==e))}function d(e){let r=o(),t=l(r,e);-1!==t&&(r[t].quantity+=1,s(r))}function c(e){let r=o(),t=l(r,e);-1!==t&&(r[t].quantity>1?r[t].quantity-=1:i(e),s(r))}function u(){return o()}},3564:(e,r,t)=>{"use strict";t.d(r,{N4:()=>i,TU:()=>l,fS:()=>o,gY:()=>n,p:()=>d,yT:()=>s});var a=t(6301);let o=async(e,r)=>{try{return(await a.S.post("/user/order/createOrder",{userId:e,items:r})).data}catch(e){var t,o;throw console.error("Error creating order:",e),Error((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||"Error creating order.")}},s=async(e,r,t,o)=>{console.log("order_id:",e),console.log("razorpayId:",r),console.log("paymentId:",t),console.log("siign:",o);try{return(await a.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:r,paymentId:t,paymentSignature:o}})).data}catch(e){var s,l;throw console.error("Error verifying payment:",e),Error((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)||"Error verifying payment.")}},l=async e=>{console.log("orderid:",e);try{return(await a.S.post("/user/order/checkoutOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},n=async e=>{console.log("userId:",e);try{return(await a.S.get("/user/order/getUserOrder?userId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},i=async e=>{console.log(e);try{return(await a.S.put("/user/order/cancelOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error cancelling order:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error cancelling order.")}},d=async e=>{console.log("userId:",e);try{let r=await a.S.get("/user/order/getOrderById?orderId=".concat(e));return console.log(r.data),r.data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}}},2913:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var a=t(3391),o=t(6301);let s=function(){let e=(0,a.d4)(e=>e.session.token),r="shopflow",t=()=>({Authorization:"Bearer ".concat(e),"Content-Type":"application/json"});this.loadCart=function(){let e=localStorage.getItem(r);return e?JSON.parse(e):[]},this.saveCart=function(e){localStorage.setItem(r,JSON.stringify(e))},this.migrateCart=async function(e){let r=this.loadCart();if(console.log(r,e),r.length>0){for(let t of r)try{console.log(t);let r=await this.addItemToCart(e,t.id,t.quantity);console.log("migrated",r)}catch(e){console.error("Error migrating cart item:",e)}this.clearCart()}},this.addItemToCart=async function(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log(e),console.log(r);try{return(await o.S.post("/user/cart/addItemToCart",{},{params:{userId:e,productId:r,quantity:a},headers:t()})).data}catch(e){throw console.log(e),console.error("Error adding item to cart:",e),e.response?e.response.data:Error("Network or server error")}},this.viewCart=async function(e){try{let r=await o.S.get("/user/cart/viewCart",{params:{userId:e},headers:t()});if(200===r.status)return r.data.data||[];throw Error(r.data.message||"Failed to retrieve cart")}catch(e){throw console.error("Error viewing cart:",e),e.response?e.response.data:Error("Network or server error")}},this.deleteFromCart=async function(e,r){try{let a=await o.S.delete("/user/cart/deleteFromCart",{params:{userId:e,productId:r},headers:t()});if(200===a.status)return a.data;throw Error(a.data.message||"Failed to delete item from cart")}catch(e){throw console.error("Error deleting item from cart:",e),e.response?e.response.data:Error("Network or server error")}},this.updateCartCount=async function(e,r,a){try{let s=await o.S.put("/user/cart/cartCount",{},{params:{userId:e,productId:r,operation:a},headers:t()});if(console.log(s.status),200===s.status)return s.data;throw Error(s.data||"Failed to update cart count")}catch(e){throw console.error("Error updating cart count:",e),e}},this.clearCart=function(){localStorage.removeItem(r)}}},2205:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var a=t(5155),o=t(2115),s=t(4234),l=t(2913),n=t(3391),i=t(6046),d=t(3564),c=t(2895);let u=()=>{let[e,r]=(0,o.useState)([]),[t,u]=(0,o.useState)(0),[g,m]=(0,o.useState)(null),[y,v]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!0),x=(0,n.wA)(),w=new l.A,j=(0,n.d4)(e=>e.session.user),N=(0,i.useRouter)();(0,o.useEffect)(()=>{(async()=>{f(!0);try{if(j){let e=await w.viewCart(j.id);r(e.items),u(e.totalAmount)}else{let e=(0,s.Xl)();r(e)}}catch(e){m("Failed to load cart. Please try again later.")}finally{f(!1)}})()},[j]);let b=async(e,t)=>{try{if(t(!0),j){await w.updateCartCount(j.id,e,"increase");let t=await w.viewCart(j.id);r(t.items),u(t.totalAmount)}else(0,s.o7)(e),r((0,s.Xl)())}catch(e){m("Failed to update item quantity. Please try again later.")}finally{t(!1)}},C=async(e,t)=>{try{if(t(!0),j){await w.updateCartCount(j.id,e,"decrease");let t=await w.viewCart(j.id);r(t.items),u(t.totalAmount)}else(0,s.CG)(e),r((0,s.Xl)())}catch(e){m("Failed to update item quantity. Please try again later.")}finally{t(!1)}},S=async(e,t)=>{try{if(t(!0),j){await w.deleteFromCart(j.id,e);let t=await w.viewCart(j.id);r(t.items),u(t.totalAmount)}else(0,s.qY)(e),r((0,s.Xl)())}catch(e){m("Failed to remove product from cart. Please try again later.")}finally{t(!1)}},E=async()=>{v(!0);try{let r=null==e?void 0:e.map(e=>({productId:e.productId,quantity:e.quantity})),{order:t}=await (0,d.fS)(j.id,r);console.log(t),x((0,c.Sd)({orders:{orders:t}})),N.push("/checkout")}catch(e){console.error(e),m("Failed to proceed with checkout. Please try again later.")}finally{v(!1)}},I=(e,r)=>{x((0,c.Sd)({id:e})),N.push("/product/".concat(r))},k=()=>{let r=e.reduce((e,r)=>e+(null==r?void 0:r.offerPrice)*(null==r?void 0:r.quantity),0);return console.log("bill",r),r};return console.log(e),(0,a.jsx)("div",{className:"bg-gray-100 min-h-screen",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto py-8 px-4 lg:px-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Shopping Cart"}),p?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Loading..."}):0===e.length?(0,a.jsx)("p",{className:"text-center text-gray-600",children:"Your cart is empty"}):(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2 bg-white rounded shadow-md p-4",children:(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map((e,r)=>(0,a.jsx)(h,{handleNavigation:I,product:j?e.product:e,onIncreaseQuantity:b,onDecreaseQuantity:C,onRemoveProduct:S,quantity:null==e?void 0:e.quantity},r))})}),(0,a.jsxs)("div",{className:"bg-white rounded shadow-md p-4 sticky top-16",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Price Details"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("p",{children:"Price"}),(0,a.jsxs)("p",{children:["$",j?null==t?void 0:t.toFixed(2):k()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,a.jsx)("p",{children:"Discount"}),(0,a.jsx)("p",{children:"- $0.00"})]}),(0,a.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,a.jsx)("p",{children:"Total Amount"}),(0,a.jsxs)("p",{children:["$",j?null==t?void 0:t.toFixed(2):k()]})]})]}),(0,a.jsx)("button",{onClick:j?E:()=>{x((0,c.Dh)({route:"/cart"})),N.push("/auth")},className:"w-full mt-4 py-2 rounded text-white ".concat(y?"bg-gray-500":"bg-gray-800 hover:bg-gray-900"),disabled:0===e.length||y,children:y?"Processing...":"Checkout"})]})]})]})})};function h(e){var r,t;let{handleNavigation:s,product:l,onIncreaseQuantity:n,onDecreaseQuantity:i,onRemoveProduct:d,quantity:c}=e,[u,h]=(0,o.useState)(!1);return(0,a.jsxs)("li",{className:"flex py-4 m-2 ".concat(u?"border-2 border-double border-x-orange-500 animate-pulse ":""),children:[(0,a.jsx)("img",{className:"w-16 h-16 rounded object-cover",src:null==l?void 0:l.image,alt:null==l?void 0:l.name}),(0,a.jsxs)("div",{className:"ml-4 flex-1",children:[(0,a.jsx)("h3",{onClick:()=>s(null==l?void 0:l.id,null==l?void 0:l.name),className:"text-gray-800 font-semibold",children:null==l?void 0:l.name}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:["$",null==l?void 0:null===(r=l.offerPrice)||void 0===r?void 0:r.toFixed(2)," ",(0,a.jsxs)("span",{className:"line-through text-gray-400",children:["$",null==l?void 0:null===(t=l.actualPrice)||void 0===t?void 0:t.toFixed(2)]})]}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:null==l?void 0:l.description}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-l hover:bg-gray-300",onClick:()=>i(null==l?void 0:l.id,h),disabled:u,children:"-"}),(0,a.jsx)("span",{className:"px-4 py-1 bg-gray-100",children:c}),(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 text-gray-800 rounded-r hover:bg-gray-300",onClick:()=>n(null==l?void 0:l.id,h),disabled:u,children:"+"})]})]}),(0,a.jsx)("button",{className:"ml-auto text-red-500 hover:text-red-600",onClick:()=>d(null==l?void 0:l.id,h),disabled:u,children:"Remove"})]})}function g(){return(0,a.jsx)("div",{children:(0,a.jsx)(u,{})})}},2895:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>l,Dh:()=>s,Sd:()=>o});let a=(0,t(8943).Z0)({name:"props",initialState:{product:null,history:null},reducers:{setProductData(e,r){console.log(r),e.product=r.payload,console.log(r.payload)},setHistory(e,r){e.history=r.payload,console.log(e.history)}}}),{setProductData:o,setHistory:s}=a.actions,l=a.reducer},6301:(e,r,t)=>{"use strict";t.d(r,{S:()=>a});let a=t(2651).A.create({baseURL:"https://shopflow-1-ugli.onrender.com"})}},e=>{var r=r=>e(e.s=r);e.O(0,[651,391,943,441,517,358],()=>r(3967)),_N_E=e.O()}]);
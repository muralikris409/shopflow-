(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{1717:(e,r,t)=>{Promise.resolve().then(t.bind(t,6783))},3564:(e,r,t)=>{"use strict";t.d(r,{N4:()=>d,TU:()=>n,fS:()=>a,gY:()=>l,p:()=>i,yT:()=>s});var o=t(6301);let a=async(e,r)=>{try{return(await o.S.post("/user/order/createOrder",{userId:e,items:r})).data}catch(e){var t,a;throw console.error("Error creating order:",e),Error((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Error creating order.")}},s=async(e,r,t,a)=>{console.log("order_id:",e),console.log("razorpayId:",r),console.log("paymentId:",t),console.log("siign:",a);try{return(await o.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:r,paymentId:t,paymentSignature:a}})).data}catch(e){var s,n;throw console.error("Error verifying payment:",e),Error((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||"Error verifying payment.")}},n=async e=>{console.log("orderid:",e);try{return(await o.S.post("/user/order/checkoutOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},l=async e=>{console.log("userId:",e);try{return(await o.S.get("/user/order/getUserOrder?userId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},d=async e=>{console.log(e);try{return(await o.S.put("/user/order/cancelOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error cancelling order:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error cancelling order.")}},i=async e=>{console.log("userId:",e);try{let r=await o.S.get("/user/order/getOrderById?orderId=".concat(e));return console.log(r.data),r.data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}}},2913:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var o=t(3391),a=t(6301);let s=function(){let e=(0,o.d4)(e=>e.session.token),r="shopflow",t=()=>({Authorization:"Bearer ".concat(e),"Content-Type":"application/json"});this.loadCart=function(){let e=localStorage.getItem(r);return e?JSON.parse(e):[]},this.saveCart=function(e){localStorage.setItem(r,JSON.stringify(e))},this.migrateCart=async function(e){let r=this.loadCart();if(console.log(r,e),r.length>0){for(let t of r)try{console.log(t);let r=await this.addItemToCart(e,t.id,t.quantity);console.log("migrated",r)}catch(e){console.error("Error migrating cart item:",e)}this.clearCart()}},this.addItemToCart=async function(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;console.log(e),console.log(r);try{return(await a.S.post("/user/cart/addItemToCart",{},{params:{userId:e,productId:r,quantity:o},headers:t()})).data}catch(e){throw console.log(e),console.error("Error adding item to cart:",e),e.response?e.response.data:Error("Network or server error")}},this.viewCart=async function(e){try{let r=await a.S.get("/user/cart/viewCart",{params:{userId:e},headers:t()});if(200===r.status)return r.data.data||[];throw Error(r.data.message||"Failed to retrieve cart")}catch(e){throw console.error("Error viewing cart:",e),e.response?e.response.data:Error("Network or server error")}},this.deleteFromCart=async function(e,r){try{let o=await a.S.delete("/user/cart/deleteFromCart",{params:{userId:e,productId:r},headers:t()});if(200===o.status)return o.data;throw Error(o.data.message||"Failed to delete item from cart")}catch(e){throw console.error("Error deleting item from cart:",e),e.response?e.response.data:Error("Network or server error")}},this.updateCartCount=async function(e,r,o){try{let s=await a.S.put("/user/cart/cartCount",{},{params:{userId:e,productId:r,operation:o},headers:t()});if(console.log(s.status),200===s.status)return s.data;throw Error(s.data||"Failed to update cart count")}catch(e){throw console.error("Error updating cart count:",e),e}},this.clearCart=function(){localStorage.removeItem(r)}}},2787:(e,r,t)=>{"use strict";t.d(r,{Ad:()=>m,BD:()=>d,E1:()=>v,Hh:()=>l,PC:()=>p,RW:()=>u,bJ:()=>g,d6:()=>n,iD:()=>s,qk:()=>c,xw:()=>i,yU:()=>h});var o=t(6301),a=t(5132);async function s(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{email:t,password:s}=e;try{let e=await o.S.post("user/login",{email:t,password:s});console.log(e.data);let{token:n,data:l}=e.data;return console.log(n,l),(0,a.setCookie)(r,"shopflow_session",JSON.stringify({user:l,token:n}),{maxAge:2592e3,path:"/",secure:!0,sameSite:"lax"}),{data:l,token:n}}catch(e){throw console.log(e),Error(e.response||"An error occurred during login.")}}async function n(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let t=await o.S.post("user/oauth",{name:null==e?void 0:e.name,email:null==e?void 0:e.email,image:null==e?void 0:e.image,id:null==e?void 0:e.id}),{token:s,data:n}=t.data;return(0,a.setCookie)(r,"shopflow_session",JSON.stringify({user:n,token:s}),{maxAge:2592e3,path:"/",secure:!0,httpOnly:!0,sameSite:"lax"}),t.data}catch(e){throw Error(e||"An error occurred during Google OAuth.")}}async function l(e){let{username:r,email:t,password:a}=e;try{return(await o.S.post("user/signup",{name:r,email:t,password:a},{headers:{"Content-Type":"application/json"}})).data}catch(e){throw Error(e.response.data.message||"An error occurred during sign-up.")}}async function d(e){try{var r;let t=await o.S.post("user/forgotPassword?email=".concat(e));if(console.log(t),200===t.status)return{ok:!0,data:t.data};return{ok:!1,message:(null===(r=t.data)||void 0===r?void 0:r.message)||"Something went wrong."}}catch(e){throw console.log(e),e}}async function i(e,r){try{return await o.S.post("user/resetPassword?token=".concat(e,"&newPassword=").concat(r))}catch(e){console.log(e)}}async function c(e,r){try{console.log("test");let t=await o.S.post("user/userProfileInfo?userId=".concat(r),{},{headers:{Authorization:"Bearer ".concat(e)}});return console.log(t),t}catch(e){console.log(e)}}async function u(e,r,t){try{console.log("test");let a=await o.S.post("user/updateUserProfile?userId=".concat(r),t,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}});return console.log(a),a}catch(e){console.log(e)}}async function m(e,r){try{console.log("token",e);let t=await o.S.post("user/getAllAddress?userId=".concat(r),{},{headers:{Authorization:"Bearer ".concat(e)}});return console.log(t),t.data}catch(e){return console.error("Error fetching addresses:",e),{error:e.message||"Something went wrong!"}}}let g=async(e,r,t)=>{try{let a=await o.S.post("user/makePrimaryAddress",{},{params:{userId:r,addressId:t},headers:{Authorization:"Bearer ".concat(e)}});return console.log(a),a.data}catch(e){return console.error("Error fetching addresses:",e),{error:e.message||"Something went wrong!"}}},v=async(e,r,t)=>{try{let{street:a,city:s,state:n,country:l,zip:d,isPrimary:i}=t;return(await o.S.post("user/addAddress",{},{params:{userId:r,street:a,city:s,state:n,country:l,zip:d,isPrimary:i},headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var a,s;return console.error("Error adding address:",e),{error:(null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Something went wrong!"}}},h=async(e,r,t,a)=>{try{let{street:s,city:n,state:l,country:d,zip:i,isPrimary:c}=a;return(await o.S.post("user/editAddress",{},{params:{userId:r,addressId:t,street:s,city:n,state:l,country:d,zip:i,isPrimary:c},headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var s,n;return console.error("Error adding address:",e),{error:(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||"Something went wrong!"}}},p=async(e,r,t)=>{try{return(await o.S.post("user/deleteAddress",{},{params:{userId:r,addressId:t},headers:{Authorization:"Bearer ".concat(e)}})).data}catch(e){var a,s;return console.error("Error adding address:",e),{error:(null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Something went wrong!"}}}},6783:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var o=t(5155),a=t(2115),s=t(9208);t(6301);var n=t(3564),l=t(2787),d=t(6046),i=t(3391);let c=e=>{var r,t,c;let{title:u,userId:m,orders:g,totalBill:v}=e,h=(0,d.useRouter)(),[p,y]=(0,a.useState)(!1),[f,w]=(0,a.useState)(null),x=(0,i.d4)(e=>{var r,t;return null==e?void 0:null===(t=e.session)||void 0===t?void 0:null===(r=t.user)||void 0===r?void 0:r.phone});console.log(x);let[b,S]=(0,a.useState)((null==g?void 0:null===(t=g.orders)||void 0===t?void 0:null===(r=t.order)||void 0===r?void 0:r.items)||(null==g?void 0:null===(c=g.orders)||void 0===c?void 0:c.items)),[E,N]=(0,a.useState)(x||""),[j,A]=(0,a.useState)(""),[C,k]=(0,a.useState)([]),[I,P]=(0,a.useState)(null),[O,z]=(0,a.useState)(!1),_=(0,i.d4)(e=>{var r;return null==e?void 0:null===(r=e.session)||void 0===r?void 0:r.token}),[T,B]=(0,a.useState)({street:"",city:"",state:"",country:"",zip:""}),[F,J]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=document.createElement("script");return e.src="https://checkout.razorpay.com/v1/checkout.js",document.body.appendChild(e),$(),()=>{document.body.removeChild(e)}},[m]);let $=async()=>{y(!0);let e=await (0,l.Ad)(_,m);if(console.log(e),"success"===e.status){k(e.data);let r=e.data.find(e=>e.isPrimary);r&&P(r)}else console.error((null==e?void 0:e.message)||"Error retrieving address");y(!1)},U=()=>E.trim()&&/^\d{10}$/.test(E)?"":"Valid phone number is required (10 digits).",q=(e,r)=>{let t="";return(null==r?void 0:r.trim())?"zip"!==e||/^[0-9]{5,6}$/.test(r)||(t="ZIP code must be 5-6 digits."):t="".concat(e.replace(/([A-Z])/g," $1")," is required."),J(r=>({...r,[e]:t})),!t},L=e=>{let{name:r,value:t}=e.target;B(e=>({...e,[r]:t})),q(r,t)},R=async()=>{if(Object.keys(T).every(e=>q(e,T[e])))try{let e=await (0,l.E1)(_,m,T);"success"===e.status?($(),z(!1),B({street:"",city:"",state:"",country:"",zip:""})):console.error(e.message)}catch(e){console.error(e)}},Z=async()=>{if(U()||!I){w("Please provide a valid phone number and select an address.");return}y(!0),w(null);try{var e,r;let{razorpayOrder:t,...o}=await (0,n.TU)((null==g?void 0:null===(r=g.orders)||void 0===r?void 0:null===(e=r.order)||void 0===e?void 0:e.id)||(null==g?void 0:g.orders.id)),a={key:"rzp_test_nTbKdtgjeOQLhc",amount:Math.ceil(100*v),currency:null==t?void 0:t.currency,name:"Shopflow",description:"Payment for your order",order_id:null==t?void 0:t.id,handler:async function(e){let{razorpay_payment_id:r,razorpay_signature:t,razorpay_order_id:o}=e;try{var a,l,d,i;y(!0);let e=await (0,n.yT)((null==g?void 0:null===(l=g.orders)||void 0===l?void 0:null===(a=l.order)||void 0===a?void 0:a.id)||(null==g?void 0:g.orders.id),o,r,t);y(!1),e.success?(s.A.set("orderId",(null==g?void 0:null===(i=g.orders)||void 0===i?void 0:null===(d=i.order)||void 0===d?void 0:d.id)||(null==g?void 0:g.orders.id)),h.push("/orders/success")):w("Payment verification failed. Please try again.")}catch(e){w("An unexpected error occurred during verification. Please try again.")}},prefill:{name:I.fullName,email:"customer@example.com",contact:E},theme:{color:"#F37254"},modal:{ondismiss:async()=>{w("Payment was cancelled by the user. Please try again.")}}};new window.Razorpay(a).open()}catch(e){w("Payment process failed. Please try again.")}finally{y(!1)}};return(0,a.useEffect)(()=>{A(U())},[E]),(0,o.jsxs)("div",{className:"bg-gray-100",children:[f&&(0,o.jsx)("div",{className:"bg-red-500 text-white p-4 rounded mb-4",children:f}),(0,o.jsxs)("div",{className:"p-6 shadow-md bg-white",children:[(0,o.jsx)("h1",{className:"text-xl font-semibold border-b pb-4",children:u}),(0,o.jsxs)("div",{className:"mb-6 mt-4",children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Phone Number"}),(0,o.jsx)("input",{type:"text",value:E,onChange:e=>N(e.target.value),className:"w-full rounded-lg border p-3 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j?"border-red-500 ring-red-500":"border-gray-300"),placeholder:"Enter your 10-digit phone number"}),j&&(0,o.jsx)("p",{className:"text-sm text-red-500 mt-2 italic",children:j})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("h2",{className:"text-lg font-medium text-gray-700",children:"Select Delivery Address"}),(0,o.jsx)("div",{className:"mt-2 border rounded p-4",children:C.map(e=>(0,o.jsxs)("div",{className:"flex items-center mb-4 p-4 rounded-lg border-2 ".concat((null==I?void 0:I.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-300 bg-white"," shadow-sm hover:shadow-md transition-shadow duration-200"),children:[(0,o.jsx)("input",{type:"radio",name:"address",checked:(null==I?void 0:I.id)===e.id,onChange:()=>P(e),className:"mr-4 h-5 w-5 accent-blue-500 cursor-pointer"}),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("p",{className:"text-base text-blue-700 font-semibold",children:e.street}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:"".concat(e.city,", ").concat(e.state,", ").concat(e.zip)})]})]},e.id))}),(0,o.jsx)("button",{className:"text-blue-600 underline mt-2",onClick:()=>z(!O),children:O?"Cancel":"+ Add New Address"}),O&&(0,o.jsxs)("div",{className:"mt-4 border rounded p-4 bg-gray-50",children:[Object.keys(T).map(e=>(0,o.jsxs)("div",{className:"mb-3",children:[(0,o.jsx)("label",{className:"block text-sm font-medium capitalize text-gray-600",htmlFor:e,children:e.replace(/([A-Z])/g," $1")}),(0,o.jsx)("input",{type:"text",id:e,name:e,value:T[e],onChange:L,className:"w-full rounded border p-2 text-sm ".concat(F[e]?"border-red-500":"border-gray-300"),placeholder:"Enter ".concat(e.replace(/([A-Z])/g," $1").toLowerCase())}),F[e]&&(0,o.jsx)("p",{className:"text-sm text-red-500 mt-1",children:F[e]})]},e)),(0,o.jsx)("button",{className:"bg-gray-800 text-white py-2 px-4 rounded mt-2 hover:bg-gray-700",onClick:R,children:"Save Address"})]})]}),(0,o.jsxs)("div",{className:"mt-4 ".concat(!I||j?"opacity-50 pointer-events-none":""),children:[(0,o.jsx)("h2",{className:"text-lg font-medium text-gray-700 mb-4 border-b pb-2",children:"Order Summary"}),null==b?void 0:b.map((e,r)=>{var t,a,s,n,l;return(0,o.jsxs)("div",{className:"flex items-center mb-4",children:[(0,o.jsx)("img",{className:"w-20 h-20 object-cover rounded border",src:(null===(t=e.product)||void 0===t?void 0:t.image)||"/_assets/image.png",alt:null===(a=e.product)||void 0===a?void 0:a.name}),(0,o.jsxs)("div",{className:"ml-4",children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-gray-800",children:null===(s=e.product)||void 0===s?void 0:s.name}),(0,o.jsx)("p",{className:"text-sm text-gray-500",children:null===(n=e.product)||void 0===n?void 0:n.description}),(0,o.jsxs)("p",{className:"text-sm font-bold text-gray-800",children:["$",null===(l=e.product)||void 0===l?void 0:l.offerPrice]})]})]},r)}),(0,o.jsx)("div",{className:"border-t pt-4",children:(0,o.jsxs)("p",{className:"font-medium text-lg text-gray-800",children:["Total: $",v]})})]}),(0,o.jsx)("div",{className:"mt-6 text-center",children:(0,o.jsx)("button",{className:"w-full p-3 rounded text-white ".concat(p?"bg-gray-500":"bg-gray-600 hover:bg-gray-700"),disabled:!I||j||p,onClick:Z,children:p?"Processing...":"Proceed to Payment"})})]})]})};var u=t(2913);let m=function(){var e;let[r,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!0),[l,d]=(0,a.useState)([]),m=new u.A,g=(0,i.d4)(e=>{var r,t;return null==e?void 0:null===(t=e.utils)||void 0===t?void 0:null===(r=t.product)||void 0===r?void 0:r.orders});console.log("reduxOrders",g);let v=(0,i.d4)(e=>{var r;return null===(r=e.session.user)||void 0===r?void 0:r.id}),h=async()=>{if(v)try{let e=await m.viewCart(v);console.log(e),t(e)}catch(e){console.error("Error fetching products:",e)}finally{n(!1)}};return((0,a.useEffect)(()=>{if(g)localStorage.setItem("orders",JSON.stringify(g)),d(g);else{let e=localStorage.getItem("orders");e&&(console.log("stored",e),d(JSON.parse(e)))}},[g]),(0,a.useEffect)(()=>{v&&h()},[v]),s)?(0,o.jsx)("div",{children:"Loading..."}):(0,o.jsx)(c,{data:r.items||[],userId:v,orders:l,totalBill:null==l?void 0:null===(e=l.orders)||void 0===e?void 0:e.totalAmount})}},6301:(e,r,t)=>{"use strict";t.d(r,{S:()=>o});let o=t(2651).A.create({baseURL:"https://shopflow-1-ugli.onrender.com"})}},e=>{var r=r=>e(e.s=r);e.O(0,[651,391,718,441,517,358],()=>r(1717)),_N_E=e.O()}]);
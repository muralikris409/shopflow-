(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[956],{4684:(e,r,t)=>{Promise.resolve().then(t.bind(t,3575))},6046:(e,r,t)=>{"use strict";var o=t(6658);t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(r,{useSearchParams:function(){return o.useSearchParams}})},3564:(e,r,t)=>{"use strict";t.d(r,{N4:()=>n,TU:()=>d,fS:()=>s,gY:()=>l,p:()=>c,yT:()=>a});var o=t(6301);let s=async(e,r)=>{try{return(await o.S.post("/user/order/createOrder",{userId:e,items:r})).data}catch(e){var t,s;throw console.error("Error creating order:",e),Error((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Error creating order.")}},a=async(e,r,t,s)=>{console.log("order_id:",e),console.log("razorpayId:",r),console.log("paymentId:",t),console.log("siign:",s);try{return(await o.S.post("/user/order/verify",{},{params:{orderId:e,razorpayId:r,paymentId:t,paymentSignature:s}})).data}catch(e){var a,d;throw console.error("Error verifying payment:",e),Error((null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(a=d.data)||void 0===a?void 0:a.message)||"Error verifying payment.")}},d=async e=>{console.log("orderid:",e);try{return(await o.S.post("/user/order/checkoutOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},l=async e=>{console.log("userId:",e);try{return(await o.S.get("/user/order/getUserOrder?userId=".concat(e))).data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}},n=async e=>{console.log(e);try{return(await o.S.put("/user/order/cancelOrder?orderId=".concat(e))).data}catch(e){var r,t;throw console.error("Error cancelling order:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error cancelling order.")}},c=async e=>{console.log("userId:",e);try{let r=await o.S.get("/user/order/getOrderById?orderId=".concat(e));return console.log(r.data),r.data}catch(e){var r,t;throw console.error("Error fetching user orders:",e),Error((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.message)||"Error fetching user orders.")}}},3575:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});var o=t(5155),s=t(2115),a=t(3564),d=t(3391),l=t(2895),n=t(6046);let c=e=>{let{product:r,onCancel:t,cancelLoading:s}=e,a=(0,n.useRouter)(),c=(0,d.wA)();return(0,o.jsxs)("div",{className:"product-card p-5 bg-white rounded-lg shadow-lg mb-4",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"text-xl font-semibold text-gray-800",children:["Order ID: ",(0,o.jsxs)("span",{className:"text-gray-500",children:["#",r.orderId]})]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["Placed on: ",new Date(r.orderDate).toLocaleDateString()]})]}),(0,o.jsx)("p",{className:"font-semibold ".concat("CONFIRMED"===r.status?"text-green-600":"CANCELLED"===r.status?"text-red-600":"text-gray-600"),children:r.status})]}),(0,o.jsxs)("div",{onClick:()=>{c((0,l.Sd)({id:r.orderId})),a.push("/product/".concat(r.productName))},className:"flex items-start space-x-4 mb-4",children:[(0,o.jsx)("img",{src:r.image||"/_assets/image.png",alt:r.productName,className:"w-16 h-16 object-cover rounded-md border"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("p",{className:"text-sm font-semibold",children:r.productName}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["$ ",r.offerPrice.toLocaleString()," x ",r.quantity]})]})]}),(0,o.jsxs)("div",{className:"flex justify-between items-center",children:[(0,o.jsxs)("p",{className:"font-semibold text-lg",children:["Total: $ ",(r.offerPrice*r.quantity).toLocaleString()]}),"CANCELLED"!==r.status&&(0,o.jsx)("button",{className:"px-4 py-2 text-white text-sm rounded ".concat(s===r.orderId?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"),onClick:()=>{t(r.orderId)},disabled:s===r.orderId,children:s===r.orderId?"Cancelling...":"Cancel Order"})]})]})},i=()=>{let[e,r]=(0,s.useState)([]),[t,l]=(0,s.useState)([]),[n,i]=(0,s.useState)(!0),[u,g]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[v,x]=(0,s.useState)(""),p=(0,d.d4)(e=>{var r;return null===(r=e.session.user)||void 0===r?void 0:r.id});(0,s.useEffect)(()=>{(async()=>{if(p)try{i(!0);let e=await (0,a.gY)(p),t=null==e?void 0:e.data,o=null==t?void 0:t.flatMap(e=>e.items.map(r=>({...r,orderDate:e.orderDate,totalAmount:e.total})));r(o||[]),l(o||[])}catch(e){g((null==e?void 0:e.message)||"An error occurred")}finally{i(!1)}})()},[p]);let y=async t=>{try{h(t),await (0,a.N4)(t);let o=e.map(e=>e.orderId===t?{...e,status:"CANCELLED"}:e);r(o),l(o.filter(e=>e.productName.toLowerCase().includes(v)))}catch(e){g((null==e?void 0:e.message)||"Failed to cancel order")}finally{h(null)}};return n?(0,o.jsx)("div",{className:"text-center text-lg",children:"Loading..."}):u?(0,o.jsxs)("div",{className:"text-red-500 text-center text-lg",children:["Error: ",u]}):(0,o.jsxs)("div",{className:"container mx-auto p-6",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-center mb-8",children:"My Orders"}),(0,o.jsx)("div",{className:"mb-6 flex justify-center",children:(0,o.jsx)("input",{type:"text",placeholder:"Search for products in your orders",value:v,onChange:r=>{let t=r.target.value.toLowerCase();x(t),l(e.filter(e=>e.productName.toLowerCase().includes(t)))},className:"w-96 p-3 rounded-md border border-gray-300"})}),(0,o.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:0===t.length?(0,o.jsx)("div",{className:"col-span-full text-center text-xl font-semibold text-gray-500",children:"No orders found."}):t.map((e,r)=>(0,o.jsx)(c,{product:e,onCancel:y,cancelLoading:m},"".concat(e.orderId,"-").concat(r)))})]})}},2895:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>d,Dh:()=>a,Sd:()=>s});let o=(0,t(8943).Z0)({name:"props",initialState:{product:null,history:null},reducers:{setProductData(e,r){console.log(r),e.product=r.payload,console.log(r.payload)},setHistory(e,r){e.history=r.payload,console.log(e.history)}}}),{setProductData:s,setHistory:a}=o.actions,d=o.reducer},6301:(e,r,t)=>{"use strict";t.d(r,{S:()=>o});let o=t(2651).A.create({baseURL:"https://shopflow-1-ugli.onrender.com"})}},e=>{var r=r=>e(e.s=r);e.O(0,[651,391,943,441,517,358],()=>r(4684)),_N_E=e.O()}]);